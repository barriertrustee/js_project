const canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),body=document.querySelector("body"),startingArea=document.querySelector(".starting-point"),startingBtn=document.querySelector("button#starting-btn"),killScreen=document.querySelector(".kill-screen"),h1Score=document.querySelector(".kill-screen h1"),resetButton=document.querySelector(".reset-button");canvas.width=window.innerWidth,canvas.height=window.innerHeight;let numberOfRows=25,numberOfColumns=50,squareWidth=canvas.width/numberOfColumns,squareHeight=canvas.height/numberOfRows;body.style.borderLeft=`${squareWidth}px solid hsl(21, 100%, 20%)`,body.style.borderRight=`${squareWidth}px solid hsl(21, 100%, 20%)`,body.style.borderTop=`${squareHeight}px solid hsl(21, 100%, 20%)`,body.style.borderBottom=`${squareHeight}px solid hsl(21, 100%, 20%)`;let posX=Math.floor(numberOfColumns/2),posY=Math.floor(numberOfRows/2),positions=[],snakeLength=2,leftInterval,rightInterval,upInterval,downInterval,checkLeftRightInterval=!1,checkUpDownInterval=!1,randomPosX=0,randomPosY=0;function pushingPosition(){let position={positionX:posX,positionY:posY};positions.push(position)}function drawingTheTail(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="hsl(0, 100%, 40%)",positions.forEach((position,index)=>{positions.length-1-index>=snakeLength||ctx.fillRect(position.positionX*squareWidth,position.positionY*squareHeight,squareWidth,squareHeight)})}function checkingForIntersection(interval,aFunction){let inIntersection;positions.some((position,index)=>!(positions.length-1-index>=snakeLength)&&(posX===position.positionX&&posY===position.positionY))&&(clearInterval(interval),window.removeEventListener("keydown",aFunction),losing())}function creatingFood(){let inSnakeBody;randomPosX=Math.ceil(Math.random()*(numberOfColumns-2)),randomPosY=Math.ceil(Math.random()*(numberOfRows-2)),positions.some((position,index)=>!(positions.length-1-index>=snakeLength)&&(randomPosX===position.positionX&&randomPosY===position.positionY))&&(randomPosX=Math.ceil(Math.random()*(numberOfColumns-2)),randomPosY=Math.ceil(Math.random()*(numberOfRows-2)));let apple=document.createElement("img");apple.src="./apple.svg",apple.width=squareWidth,apple.height=squareHeight,apple.style.top=`${randomPosY*squareHeight}px`,apple.style.left=`${randomPosX*squareWidth}px`,body.append(apple)}let score=0;function eatingFood(){if(posX!==randomPosX)return;if(posY!==randomPosY)return;let apple=document.querySelector("img");body.removeChild(apple),snakeLength++,creatingFood(),score++}function losing(){killScreen.style.display="flex",h1Score.innerText=`Your score is ${score}`}startingBtn.addEventListener("click",()=>{let buttonWidth=getComputedStyle(startingBtn).width;startingBtn.style.opacity=0,startingBtn.style.left=`calc(100% - ${buttonWidth})`,startingArea.style.opacity=0;let timeOut=setTimeout(()=>{creatingFood(),rightInterval=setInterval(()=>{if(pushingPosition(),posX++,posX===numberOfColumns-1)return clearInterval(rightInterval),void losing();drawingTheTail(),ctx.beginPath(),ctx.moveTo(posX*squareWidth,posY*squareHeight),ctx.lineTo((posX+1)*squareWidth,(posY+.5)*squareHeight),ctx.lineTo(posX*squareWidth,(posY+1)*squareHeight),ctx.closePath(),ctx.fill(),eatingFood()},60)},500)}),window.addEventListener("keydown",(function listener(e){switch(e.key){case"ArrowUp":case"w":case"W":if(checkUpDownInterval)break;checkUpDownInterval=!0,checkLeftRightInterval=!1,clearInterval(rightInterval),clearInterval(leftInterval),upInterval=setInterval(()=>{if(pushingPosition(),posY--,checkingForIntersection(upInterval,listener),0===posY)return window.removeEventListener("keydown",listener),clearInterval(upInterval),void losing();drawingTheTail(),ctx.beginPath(),ctx.moveTo(posX*squareWidth,(posY+1)*squareHeight),ctx.lineTo((posX+.5)*squareWidth,posY*squareHeight),ctx.lineTo((posX+1)*squareWidth,(posY+1)*squareHeight),ctx.fill(),eatingFood()},60);break;case"ArrowLeft":case"A":case"a":if(checkLeftRightInterval)break;checkLeftRightInterval=!0,checkUpDownInterval=!1,clearInterval(upInterval),clearInterval(downInterval),leftInterval=setInterval(()=>{if(pushingPosition(),posX--,checkingForIntersection(leftInterval,listener),0===posX)return window.removeEventListener("keydown",listener),clearInterval(leftInterval),void losing();drawingTheTail(),ctx.beginPath(),ctx.moveTo((posX+1)*squareWidth,posY*squareHeight),ctx.lineTo(posX*squareWidth,(posY+.5)*squareHeight),ctx.lineTo((posX+1)*squareWidth,(posY+1)*squareHeight),ctx.fill(),eatingFood()},60);break;case"ArrowDown":case"S":case"s":if(checkUpDownInterval)break;checkUpDownInterval=!0,checkLeftRightInterval=!1,clearInterval(leftInterval),clearInterval(rightInterval),downInterval=setInterval(()=>{if(pushingPosition(),posY++,checkingForIntersection(downInterval,listener),posY===numberOfRows-1)return window.removeEventListener("keydown",listener),clearInterval(downInterval),void losing();drawingTheTail(),ctx.beginPath(),ctx.moveTo(posX*squareWidth,posY*squareHeight),ctx.lineTo((posX+.5)*squareWidth,(posY+1)*squareHeight),ctx.lineTo((posX+1)*squareWidth,posY*squareHeight),ctx.fill(),eatingFood()},60);break;case"ArrowRight":case"D":case"d":if(checkLeftRightInterval)break;checkLeftRightInterval=!0,checkUpDownInterval=!1,clearInterval(upInterval),clearInterval(downInterval),rightInterval=setInterval(()=>{if(pushingPosition(),posX++,checkingForIntersection(rightInterval,listener),posX===numberOfColumns-1)return window.removeEventListener("keydown",listener),clearInterval(rightInterval),void losing();drawingTheTail(),ctx.beginPath(),ctx.moveTo(posX*squareWidth,posY*squareHeight),ctx.lineTo((posX+1)*squareWidth,(posY+.5)*squareHeight),ctx.lineTo(posX*squareWidth,(posY+1)*squareHeight),ctx.fill(),eatingFood()},60)}})),resetButton.addEventListener("click",()=>{window.location.reload()});